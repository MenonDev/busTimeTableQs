Generated html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bus Timetable Practice</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f0f8ff;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }
        .container {
            width: 90%;
            max-width: 800px;
            background-color: #fff;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border: 2px solid #4682b4;
        }
        h1 {
            text-align: center;
            color: #4682b4;
            margin-bottom: 20px;
        }
        #timetable-container {
            margin-bottom: 25px;
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            text-align: center;
        }
        th, td {
            padding: 12px 8px;
            border: 1px solid #ddd;
        }
        th {
            background-color: #4682b4;
            color: white;
        }
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        #question-area {
            padding: 20px;
            background-color: #e6f7ff;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        #question-text {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 15px;
        }
        #answer-input {
            width: 60%;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
            margin-right: 10px;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            color: white;
        }
        #submit-btn {
            background-color: #5cb85c;
        }
        #submit-btn:hover {
            background-color: #4cae4c;
        }
        #new-timetable-btn {
            background-color: #f0ad4e;
            display: block;
            margin: 20px auto 0;
        }
        #new-timetable-btn:hover {
            background-color: #ec971f;
        }
        #feedback-area {
            margin-top: 15px;
            padding: 15px;
            border-radius: 5px;
            font-weight: bold;
            text-align: center;
            display: none; /* Hidden by default */
        }
        #feedback-area.correct {
            background-color: #dff0d8;
            color: #3c763d;
            border: 1px solid #d6e9c6;
        }
        #feedback-area.wrong {
            background-color: #f2dede;
            color: #a94442;
            border: 1px solid #ebccd1;
        }
        #explanation {
            margin-top: 10px;
            font-weight: normal;
            font-size: 0.95em;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Bus Timetable Practice</h1>

        <div id="timetable-container">
            <table id="bus-timetable">
                <!-- Timetable will be generated here -->
            </table>
        </div>

        <div id="question-area">
            <p id="question-text"></p>
            <input type="text" id="answer-input" placeholder="Type your answer here">
            <button id="submit-btn" class="btn">Submit Answer</button>
            <div id="feedback-area">
                <p id="feedback-text"></p>
                <p id="explanation"></p>
            </div>
        </div>

        <button id="new-timetable-btn" class="btn">Get New Timetable</button>
    </div>

    <script>
        const stopNames = ["Cromer", "Little Snoring", "Great Snoring", "Spalding", "Lincoln", "Kingston upon Hull", "Scarborough", "Fakenham", "Holt", "Norwich"];
        let currentTimetable = {};
        let currentQuestion = {};
        let availableQuestions = [];

        const timetableEl = document.getElementById('bus-timetable');
        const questionTextEl = document.getElementById('question-text');
        const answerInputEl = document.getElementById('answer-input');
        const submitBtn = document.getElementById('submit-btn');
        const newTimetableBtn = document.getElementById('new-timetable-btn');
        const feedbackAreaEl = document.getElementById('feedback-area');
        const feedbackTextEl = document.getElementById('feedback-text');
        const explanationEl = document.getElementById('explanation');

        function formatTime(date) {
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${hours}:${minutes}`;
        }

        function generateTimetable() {
            currentTimetable = { stops: [], buses: {} };
            
            // 1. Select stops for this timetable
            const shuffledStops = [...stopNames].sort(() => 0.5 - Math.random());
            const numStops = Math.floor(Math.random() * 4) + 5; // 5 to 8 stops
            currentTimetable.stops = shuffledStops.slice(0, numStops);

            // 2. Generate bus routes
            const numBuses = Math.floor(Math.random() * 3) + 4; // 4 to 6 buses
            for (let i = 0; i < numBuses; i++) {
                const busNumber = Math.floor(Math.random() * 90) + 10; // Bus numbers 10-99
                if (currentTimetable.buses[busNumber]) { // Avoid duplicate bus numbers
                    i--;
                    continue;
                }

                const busData = { times: {} };
                let currentTime = new Date();
                currentTime.setHours(Math.floor(Math.random() * 8) + 6); // Start between 06:00 and 13:00
                currentTime.setMinutes(Math.floor(Math.random() * 60));

                // Decide which stops this bus will serve
                const servesAllStops = Math.random() > 0.3; // 70% chance to serve all stops
                let stopsServed = currentTimetable.stops;
                if (!servesAllStops) {
                    stopsServed = currentTimetable.stops.filter(() => Math.random() > 0.25);
                    if (stopsServed.length < 2) {
                         stopsServed = [currentTimetable.stops[0], currentTimetable.stops[currentTimetable.stops.length-1]];
                    }
                }
                
                stopsServed.forEach(stop => {
                    const travelTime = Math.floor(Math.random() * 25) + 10; // 10-34 mins travel
                    currentTime.setMinutes(currentTime.getMinutes() + travelTime);
                    busData.times[stop] = formatTime(currentTime);
                });
                currentTimetable.buses[busNumber] = busData;
            }
        }

        function displayTimetable() {
            timetableEl.innerHTML = ''; // Clear previous table

            // Header
            const headerRow = timetableEl.insertRow();
            const stopHeader = document.createElement('th');
            stopHeader.textContent = 'Stop';
            headerRow.appendChild(stopHeader);
            const busNumbers = Object.keys(currentTimetable.buses);
            busNumbers.forEach(num => {
                const busHeader = document.createElement('th');
                busHeader.textContent = `Bus ${num}`;
                headerRow.appendChild(busHeader);
            });

            // Body
            currentTimetable.stops.forEach(stop => {
                const row = timetableEl.insertRow();
                const stopCell = row.insertCell();
                stopCell.textContent = stop;
                busNumbers.forEach(num => {
                    const timeCell = row.insertCell();
                    timeCell.textContent = currentTimetable.buses[num].times[stop] || '----';
                });
            });
        }
        
        function timeToMinutes(timeStr) {
            const [hours, minutes] = timeStr.split(':').map(Number);
            return hours * 60 + minutes;
        }

        function minutesToHoursAndMinutes(totalMinutes) {
            if (totalMinutes < 0) totalMinutes = 0;
            const hours = Math.floor(totalMinutes / 60);
            const minutes = totalMinutes % 60;
            let result = "";
            if (hours > 0) result += `${hours} hour${hours > 1 ? 's' : ''}`;
            if (hours > 0 && minutes > 0) result += " and ";
            if (minutes > 0) result += `${minutes} minute${minutes > 1 ? 's' : ''}`;
            if(result === "") result = "0 minutes";
            return result;
        }
        
        // --- Question Generation Functions ---

        function generateDurationQuestion() {
            const busNumbers = Object.keys(currentTimetable.buses);
            const busNumber = busNumbers[Math.floor(Math.random() * busNumbers.length)];
            const servedStops = Object.keys(currentTimetable.buses[busNumber].times);

            if (servedStops.length < 2) return null; // Not enough stops for a duration question

            const stop1Index = Math.floor(Math.random() * (servedStops.length - 1));
            const stop2Index = Math.floor(Math.random() * (servedStops.length - stop1Index - 1)) + stop1Index + 1;
            
            const stopA = servedStops[stop1Index];
            const stopB = servedStops[stop2Index];
            const timeA = currentTimetable.buses[busNumber].times[stopA];
            const timeB = currentTimetable.buses[busNumber].times[stopB];

            const durationMinutes = timeToMinutes(timeB) - timeToMinutes(timeA);
            const answer = minutesToHoursAndMinutes(durationMinutes);

            return {
                text: `How long does bus ${busNumber} take to get from ${stopA} to ${stopB}?`,
                answer: answer,
                explanation: `Bus ${busNumber} leaves ${stopA} at ${timeA} and arrives at ${stopB} at ${timeB}. The difference is ${durationMinutes} minutes, which is ${answer}.`
            };
        }

        function generateFastestBusQuestion() {
            const allStops = currentTimetable.stops;
            let stopA, stopB, eligibleBuses;

            // Find two stops served by at least two buses
            for (let i = 0; i < 10; i++) { // Try 10 times to find suitable stops
                const stop1Index = Math.floor(Math.random() * (allStops.length - 1));
                const stop2Index = Math.floor(Math.random() * (allStops.length - stop1Index - 1)) + stop1Index + 1;
                stopA = allStops[stop1Index];
                stopB = allStops[stop2Index];

                eligibleBuses = Object.keys(currentTimetable.buses).filter(busNum => 
                    currentTimetable.buses[busNum].times[stopA] && currentTimetable.buses[busNum].times[stopB]
                );
                
                if (eligibleBuses.length >= 2) break;
            }

            if (eligibleBuses.length < 2) return null; // Couldn't find a suitable pair

            let fastestBus = '';
            let minDuration = Infinity;
            let explanationText = `Let's compare the travel times from ${stopA} to ${stopB}:\n`;

            eligibleBuses.forEach(busNum => {
                const timeA = currentTimetable.buses[busNum].times[stopA];
                const timeB = currentTimetable.buses[busNum].times[stopB];
                const duration = timeToMinutes(timeB) - timeToMinutes(timeA);
                explanationText += `\n- Bus ${busNum}: ${timeB} - ${timeA} = ${duration} minutes.`;
                if (duration < minDuration) {
                    minDuration = duration;
                    fastestBus = busNum;
                }
            });

            explanationText += `\n\nThe fastest is bus ${fastestBus} with a journey time of ${minDuration} minutes.`;

            return {
                text: `Which is the fastest bus from ${stopA} to ${stopB}?`,
                answer: fastestBus,
                explanation: explanationText
            };
        }
        
        function convertTo12Hour(timeStr) {
            const [hours, minutes] = timeStr.split(':');
            const h = parseInt(hours, 10);
            const suffix = h >= 12 ? 'pm' : 'am';
            const convertedHour = ((h + 11) % 12 + 1);
            return `${convertedHour}:${minutes} ${suffix}`;
        }

        function generate12HourRewriteQuestion() {
            const busNumbers = Object.keys(currentTimetable.buses);
            const busNumber = busNumbers[Math.floor(Math.random() * busNumbers.length)];
            const firstStop = Object.keys(currentTimetable.buses[busNumber].times)[0];
            const time24 = currentTimetable.buses[busNumber].times[firstStop];
            const time12 = convertTo12Hour(time24);
            
            return {
                text: `Bus ${busNumber} leaves its first stop, ${firstStop}, at ${time24}. What is this time in 12-hour clock format? (e.g., 7:30 pm)`,
                answer: time12,
                explanation: `To convert ${time24} to 12-hour format: If the hour is 12, it's pm. If it's over 12, subtract 12 and add pm. If it's 00, it's 12 am. Otherwise, it's am. So, ${time24} is ${time12}.`
            };
        }

        // --- Main Logic ---

        function generateNewQuestion() {
            if (availableQuestions.length === 0) {
                // Generate all possible questions for this timetable
                const questionFunctions = [generateDurationQuestion, generateFastestBusQuestion, generate12HourRewriteQuestion];
                for (let i=0; i<10; i++) { // Generate up to 10 questions
                   const qFunc = questionFunctions[Math.floor(Math.random() * questionFunctions.length)];
                   const question = qFunc();
                   if (question) {
                       const isDuplicate = availableQuestions.some(aq => aq.text === question.text);
                       if (!isDuplicate) availableQuestions.push(question);
                   }
                }
            }

            // Pick a random question from the list
            if (availableQuestions.length > 0) {
                 const questionIndex = Math.floor(Math.random() * availableQuestions.length);
                 currentQuestion = availableQuestions.splice(questionIndex, 1)[0]; // Pick and remove
            } else {
                // If somehow no questions could be generated, make a simple one
                 currentQuestion = { text: "Click 'Get New Timetable' for more questions!", answer: "", explanation: ""};
            }

            questionTextEl.textContent = currentQuestion.text;
            resetAnswerState();
        }

        function resetAnswerState() {
            answerInputEl.value = '';
            feedbackAreaEl.style.display = 'none';
            answerInputEl.disabled = false;
            submitBtn.disabled = false;
        }

        function checkAnswer() {
            const userAnswer = answerInputEl.value.trim().toLowerCase();
            const correctAnswer = String(currentQuestion.answer).toLowerCase();
            
            // Normalize answer for comparison
            const normalizedUserAnswer = userAnswer.replace(/bus /g, '').replace(/\s/g, '');
            const normalizedCorrectAnswer = correctAnswer.replace(/bus /g, '').replace(/\s/g, '');

            feedbackAreaEl.style.display = 'block';
            answerInputEl.disabled = true;
            submitBtn.disabled = true;

            if (normalizedUserAnswer === normalizedCorrectAnswer) {
                feedbackAreaEl.className = 'correct';
                feedbackTextEl.textContent = 'Correct! Well done!';
                explanationEl.textContent = currentQuestion.explanation;
            } else {
                feedbackAreaEl.className = 'wrong';
                feedbackTextEl.textContent = 'Not quite, have another look.';
                explanationEl.innerHTML = `<strong>The correct answer is: ${currentQuestion.answer}</strong><br><br>${currentQuestion.explanation}`;
            }
        }
        
        function startNewRound() {
            generateTimetable();
            displayTimetable();
            availableQuestions = []; // Reset the question pool
            generateNewQuestion();
        }

        submitBtn.addEventListener('click', checkAnswer);
        newTimetableBtn.addEventListener('click', startNewRound);
        answerInputEl.addEventListener('keyup', (event) => {
            if (event.key === "Enter") {
                checkAnswer();
            }
        });

        // Initial load
        startNewRound();
    </script>
</body>
</html>
